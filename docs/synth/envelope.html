<head>
  <link href="../favicon.ico" rel="shortcut icon" type="image/x-icon"/>
  <link href="../style.css" rel="stylesheet"/>
  <title>BQN Musician: Envelopes</title>
</head>
<div class="nav">(<a href="https://github.com/mlochbaum/BQN-musician">github</a>) / <a href="../index.html">BQN Musician</a> / <a href="index.html">synth</a></div>
<h1 id="envelopes"><a class="header" href="#envelopes">Envelopes</a></h1>
<p>The envelope of a sound is how its volume changes as it's played, a sort of overall contour. A typical way to make a synthesized note is to multiply a continuous tone (whether an <a href="oscillator.html">oscillator</a> or something more complicated) by an envelope signal. To avoid changing that tone, the envelope shouldn't have any audible contentâ€”the volume should change gradually enough that it doesn't really contain frequencies above 20Hz. But the right envelope affects how the sound is perceived to a surprising degree, and can help a track sound more natural and compelling. This matters more in a dense mix: if one line just isn't fitting in, adjusting the envelope is something to try.</p>
<a class="replLink" title="Open in the REPL" target="_blank" href="https://mlochbaum.github.io/BQN/try.html#code=cyDihpAgNDQxMDAgICMgU2FtcGxlcyBpbiBvbmUgc2Vjb25kCnRvbmUg4oaQIOKAom1hdGguU2luICgyw5fPgCkgw5cgNDQwIMOXIOKGleKKuMO3IHMKIyBUaGUgcHVyZSB0b25lCuKAolBsYXkgdG9uZQojIFdpdGggc29tZSBzYW1wbGUgZW52ZWxvcGVzIGFwcGxpZWQK4oCiUGxheSDiiL7LnCB7MC45OTnii4bihpXiiaDwnZWpfeKKuMOXIHRvbmUK4oCiUGxheSDiiL7LnCB7MC45OTk54ouG4oaV4omg8J2VqX3iirjDlyB0b25lCuKAolBsYXkg4oi+y5wge2nihpDihpXiiaDwnZWp4ouEKGnDtzMwMCnijIoo4oy9MOKMiDQty5xpw7cyZTMp4oyKw7cxKzJlwq80w5dpfeKKuMOXIHRvbmU=">â†—ï¸</a><pre>    <span class='Value'>s</span> <span class='Gets'>â†</span> <span class='Number'>44100</span>  <span class='Comment'># Samples in one second
</span>    <span class='Value'>tone</span> <span class='Gets'>â†</span> <span class='Value'>â€¢math.</span><span class='Function'>Sin</span> <span class='Paren'>(</span><span class='Number'>2</span><span class='Function'>Ã—</span><span class='Number'>Ï€</span><span class='Paren'>)</span> <span class='Function'>Ã—</span> <span class='Number'>440</span> <span class='Function'>Ã—</span> <span class='Function'>â†•</span><span class='Modifier2'>âŠ¸</span><span class='Function'>Ã·</span> <span class='Value'>s</span>
    <span class='Comment'># The pure tone
</span>    <span class='Function'>Play</span> <span class='Value'>tone</span>
<audio src="audio_envelope/a0.mp3" controls></audio>
    <span class='Comment'># With some sample envelopes applied
</span>    <span class='Function'>Play</span> <span class='Function'>âˆ¾</span><span class='Modifier'>Ëœ</span> <span class='Brace'>{</span><span class='Number'>0.999</span><span class='Function'>â‹†â†•â‰ </span><span class='Value'>ğ•©</span><span class='Brace'>}</span><span class='Modifier2'>âŠ¸</span><span class='Function'>Ã—</span> <span class='Value'>tone</span>
<audio src="audio_envelope/a1.mp3" controls></audio>
    <span class='Function'>Play</span> <span class='Function'>âˆ¾</span><span class='Modifier'>Ëœ</span> <span class='Brace'>{</span><span class='Number'>0.9999</span><span class='Function'>â‹†â†•â‰ </span><span class='Value'>ğ•©</span><span class='Brace'>}</span><span class='Modifier2'>âŠ¸</span><span class='Function'>Ã—</span> <span class='Value'>tone</span>
<audio src="audio_envelope/a2.mp3" controls></audio>
    <span class='Function'>Play</span> <span class='Function'>âˆ¾</span><span class='Modifier'>Ëœ</span> <span class='Brace'>{</span><span class='Value'>i</span><span class='Gets'>â†</span><span class='Function'>â†•â‰ </span><span class='Value'>ğ•©</span><span class='Separator'>â‹„</span><span class='Paren'>(</span><span class='Value'>i</span><span class='Function'>Ã·</span><span class='Number'>300</span><span class='Paren'>)</span><span class='Function'>âŒŠ</span><span class='Paren'>(</span><span class='Function'>âŒ½</span><span class='Number'>0</span><span class='Function'>âŒˆ</span><span class='Number'>4</span><span class='Function'>-</span><span class='Modifier'>Ëœ</span><span class='Value'>i</span><span class='Function'>Ã·</span><span class='Number'>2e3</span><span class='Paren'>)</span><span class='Function'>âŒŠÃ·</span><span class='Number'>1</span><span class='Function'>+</span><span class='Number'>2eÂ¯4</span><span class='Function'>Ã—</span><span class='Value'>i</span><span class='Brace'>}</span><span class='Modifier2'>âŠ¸</span><span class='Function'>Ã—</span> <span class='Value'>tone</span>
<audio src="audio_envelope/a3.mp3" controls></audio>
</pre>
<p>(One comment on composition: silence is a big deal! The riffs that really land often have rests where you'd expect a note, or a carefully placed stacatto. Is that one change you're searching for to add, or to take away?)</p>
<h2 id="decay"><a class="header" href="#decay">Decay</a></h2>
<p>Like a sine wave is the most basic oscillator, I think of exponential decay as the most basic envelope. They're pretty closely related: a perfect oscillator gives you a sine wave, but one with friction gives you a sine with exponential decay.</p>
<svg viewBox='-30 -30 336 118'>
  <g text-anchor='middle' fill='none'>
    <text fill='currentColor' x='128' y='-10'>Exponential decay</text>
    <path stroke='currentColor' stroke-width='2' d='M0 0L6.4 4.624L12.8 8.915L19.2 12.895L25.6 16.588L32 20.013L38.4 23.192L44.8 26.14L51.2 28.876L57.6 31.414L64 33.769L70.4 35.953L76.8 37.98L83.2 39.86L89.6 41.604L96 43.222L102.4 44.724L108.8 46.116L115.2 47.409L121.6 48.607L128 49.72L134.4 50.752L140.8 51.709L147.2 52.597L153.6 53.421L160 54.185L166.4 54.894L172.8 55.552L179.2 56.163L185.6 56.729L192 57.254L198.4 57.742L204.8 58.194L211.2 58.614L217.6 59.003L224 59.364L230.4 59.699L236.8 60.01L243.2 60.298L249.6 60.565L256 60.814'/>
    <path stroke='currentColor' stroke-width='1' stroke-dasharray='5 7' d='M0 64L256 64'/>
  </g>
</svg>

<a class="replLink" title="Open in the REPL" target="_blank" href="https://mlochbaum.github.io/BQN/try.html#code=cyDihpAgNDQxMDAgICMgU2FtcGxlcyBpbiBvbmUgc2Vjb25kCnRvbmUg4oaQIOKAom1hdGguU2luICgyw5fPgCkgw5cgNDQwIMOXIOKGleKKuMO3IHMK4oCiUGxheSAoMC45OTk5NCDii4Yg4oaVNMOXcykgw5cgKDTDl3MpIOKliiB0b25l">â†—ï¸</a><pre>    <span class='Function'>Play</span> <span class='Paren'>(</span><span class='Number'>0.99994</span> <span class='Function'>â‹†</span> <span class='Function'>â†•</span><span class='Number'>4</span><span class='Function'>Ã—</span><span class='Value'>s</span><span class='Paren'>)</span> <span class='Function'>Ã—</span> <span class='Paren'>(</span><span class='Number'>4</span><span class='Function'>Ã—</span><span class='Value'>s</span><span class='Paren'>)</span> <span class='Function'>â¥Š</span> <span class='Value'>tone</span>
<audio src="audio_envelope/a4.mp3" controls></audio>
</pre>
<p>The start is too sharp to match anything real (we'll get to that), but eventually it starts to sound like a tuning fork, or maybe some sort of chime. These are very nearly perfect oscillators with friction!</p>
<p>The envelope <code><span class='Number'>0.99994</span> <span class='Function'>â‹†</span> <span class='Function'>â†•</span><span class='Number'>4</span><span class='Function'>Ã—</span><span class='Value'>s</span></code> simply starts at one and decreases by a factor of <code><span class='Number'>0.99994</span></code> each time. But that constant isn't very nice to work with, because counting nines is no fun. What I do instead of changing the base of the exponent is to use a fixed base and multiply the exponential part. This is equivalent to changing the base because <code><span class='Value'>b</span><span class='Function'>â‹†</span><span class='Value'>c</span><span class='Function'>Ã—</span><span class='Value'>i</span></code> is <code><span class='Paren'>(</span><span class='Value'>b</span><span class='Function'>â‹†</span><span class='Value'>c</span><span class='Paren'>)</span><span class='Function'>â‹†</span><span class='Value'>i</span></code>. Another thing I'll do while I'm tidying up the code is avoid repeating the length. I'll make a function to compute the envelope from the signal being enveloped, and then apply it with <code><span class='Function'>Env</span><span class='Modifier2'>âŠ¸</span><span class='Function'>Ã—</span></code>. Since the <a href="https://mlochbaum.github.io/BQN/doc/hook.html">hook</a> <code><span class='Function'>Env</span><span class='Modifier2'>âŠ¸</span><span class='Function'>Ã—</span> <span class='Value'>s</span></code> means <code><span class='Paren'>(</span><span class='Function'>Env</span> <span class='Value'>s</span><span class='Paren'>)</span> <span class='Function'>Ã—</span> <span class='Value'>s</span></code>, this multiplies the signal by its envelope.</p>
<a class="replLink" title="Open in the REPL" target="_blank" href="https://mlochbaum.github.io/BQN/try.html#code=cyDihpAgNDQxMDAgICMgU2FtcGxlcyBpbiBvbmUgc2Vjb25kCnRvbmUg4oaQIOKAom1hdGguU2luICgyw5fPgCkgw5cgNDQwIMOXIOKGleKKuMO3IHMK4ouG4oG8IDAuOTk5OTQK4p+oMC45OTk5NOKLhjAuNCwg4ouGKOKLhuKBvDAuOTk5OTQpw5cwLjTin6kgICMgU2FtZSB0aGluZyEKCiMgICAgKOKLhiDCrzZlwq81IMOX4oaVNMOXcykgw5cgKDTDl3MpIOKliiB0b25lCuKAolBsYXkge+KLhiDCrzZlwq81IMOXIOKGleKJoPCdlal94oq4w5cgKDTDl3MpIOKliiB0b25l">â†—ï¸</a><pre>    <span class='Function'>â‹†</span><span class='Modifier'>â¼</span> <span class='Number'>0.99994</span>
Â¯6.000180007195222eÂ¯5
    <span class='Bracket'>âŸ¨</span><span class='Number'>0.99994</span><span class='Function'>â‹†</span><span class='Number'>0.4</span><span class='Separator'>,</span> <span class='Function'>â‹†</span><span class='Paren'>(</span><span class='Function'>â‹†</span><span class='Modifier'>â¼</span><span class='Number'>0.99994</span><span class='Paren'>)</span><span class='Function'>Ã—</span><span class='Number'>0.4</span><span class='Bracket'>âŸ©</span>  <span class='Comment'># Same thing!
</span>âŸ¨ 0.9999759995679862 0.9999759995679862 âŸ©

    <span class='Comment'>#    (â‹† Â¯6eÂ¯5 Ã—â†•4Ã—s) Ã— (4Ã—s) â¥Š tone
</span>    <span class='Function'>Play</span> <span class='Brace'>{</span><span class='Function'>â‹†</span> <span class='Number'>Â¯6eÂ¯5</span> <span class='Function'>Ã—</span> <span class='Function'>â†•â‰ </span><span class='Value'>ğ•©</span><span class='Brace'>}</span><span class='Modifier2'>âŠ¸</span><span class='Function'>Ã—</span> <span class='Paren'>(</span><span class='Number'>4</span><span class='Function'>Ã—</span><span class='Value'>s</span><span class='Paren'>)</span> <span class='Function'>â¥Š</span> <span class='Value'>tone</span>
<audio src="audio_envelope/a5.mp3" controls></audio>
</pre>
<p>Now I can adjust the constant to control the decay time. For example, one that's five times as big gives a signal five times shorter. You could divide by a constant instead (<code><span class='Number'>Â¯1.6e4</span> <span class='Function'>Ã·</span><span class='Modifier'>Ëœ</span></code> in place of <code><span class='Number'>Â¯6eÂ¯5</span> <span class='Function'>Ã—</span></code> and <code><span class='Number'>Â¯3e3</span> <span class='Function'>Ã·</span><span class='Modifier'>Ëœ</span></code> for <code><span class='Number'>Â¯3eÂ¯4</span> <span class='Function'>Ã—</span></code>) to have something that scales as a duration if that's easier.</p>
<a class="replLink" title="Open in the REPL" target="_blank" href="https://mlochbaum.github.io/BQN/try.html#code=cyDihpAgNDQxMDAgICMgU2FtcGxlcyBpbiBvbmUgc2Vjb25kCnRvbmUg4oaQIOKAom1hdGguU2luICgyw5fPgCkgw5cgNDQwIMOXIOKGleKKuMO3IHMK4oCiUGxheSB74ouGIMKvM2XCrzQgw5cg4oaV4omg8J2VqX3iirjDlyAoNMOXcykg4qWKIHRvbmU=">â†—ï¸</a><pre>    <span class='Function'>Play</span> <span class='Brace'>{</span><span class='Function'>â‹†</span> <span class='Number'>Â¯3eÂ¯4</span> <span class='Function'>Ã—</span> <span class='Function'>â†•â‰ </span><span class='Value'>ğ•©</span><span class='Brace'>}</span><span class='Modifier2'>âŠ¸</span><span class='Function'>Ã—</span> <span class='Paren'>(</span><span class='Number'>4</span><span class='Function'>Ã—</span><span class='Value'>s</span><span class='Paren'>)</span> <span class='Function'>â¥Š</span> <span class='Value'>tone</span>
<audio src="audio_envelope/a6.mp3" controls></audio>
</pre>
<p>Exponential decay makes for a very clean, polite approach. To put more emphasis on a sound I often try something that sticks around longer. One simple way is to add a small constant to the exponential. This generalizes to two exponentials with different basesâ€”the lower one gives an initial impact and then the higher one sustains, but not necessarily forever like the constant. Or any number of them, but eventually you're basically taking the <a href="https://en.wikipedia.org/wiki/Laplace_transform">Laplace transform</a> of some function that's not very much like an exponential, and it's better to just use another function. An aggressive choice is a function that falls off with <code><span class='Function'>Ã·</span><span class='Value'>i</span></code> (or <code><span class='Value'>i</span><span class='Function'>â‹†</span><span class='Number'>Â¯1</span></code>) instead of <code><span class='Function'>â‹†-</span><span class='Value'>i</span></code>. Hear how it starts with less power but just keeps going.</p>
<svg viewBox='-30 -30 336 118'>
  <g text-anchor='middle' fill='none'>
    <text fill='currentColor' x='128' y='-10'>1/t decay</text>
    <path stroke='currentColor' stroke-width='2' d='M0 0L6.4 12.8L12.8 21.333L19.2 27.429L25.6 32L32 35.556L38.4 38.4L44.8 40.727L51.2 42.667L57.6 44.308L64 45.714L70.4 46.933L76.8 48L83.2 48.941L89.6 49.778L96 50.526L102.4 51.2L108.8 51.81L115.2 52.364L121.6 52.87L128 53.333L134.4 53.76L140.8 54.154L147.2 54.519L153.6 54.857L160 55.172L166.4 55.467L172.8 55.742L179.2 56L185.6 56.242L192 56.471L198.4 56.686L204.8 56.889L211.2 57.081L217.6 57.263L224 57.436L230.4 57.6L236.8 57.756L243.2 57.905L249.6 58.047L256 58.182'/>
    <path stroke='currentColor' stroke-width='1' stroke-dasharray='5 7' d='M0 64L256 64'/>
  </g>
</svg>

<a class="replLink" title="Open in the REPL" target="_blank" href="https://mlochbaum.github.io/BQN/try.html#code=cyDihpAgNDQxMDAgICMgU2FtcGxlcyBpbiBvbmUgc2Vjb25kCnRvbmUg4oaQIOKAom1hdGguU2luICgyw5fPgCkgw5cgNDQwIMOXIOKGleKKuMO3IHMK4oCiUGxheSB7w7cxKzFlwq8zw5fihpXiiaDwnZWpfeKKuMOXICg0w5dzKSDipYogdG9uZQ==">â†—ï¸</a><pre>    <span class='Function'>Play</span> <span class='Brace'>{</span><span class='Function'>Ã·</span><span class='Number'>1</span><span class='Function'>+</span><span class='Number'>1eÂ¯3</span><span class='Function'>Ã—â†•â‰ </span><span class='Value'>ğ•©</span><span class='Brace'>}</span><span class='Modifier2'>âŠ¸</span><span class='Function'>Ã—</span> <span class='Paren'>(</span><span class='Number'>4</span><span class='Function'>Ã—</span><span class='Value'>s</span><span class='Paren'>)</span> <span class='Function'>â¥Š</span> <span class='Value'>tone</span>
<audio src="audio_envelope/a7.mp3" controls></audio>
</pre>
<p>The <code><span class='Number'>1</span><span class='Function'>+</span></code> avoids a division by zero, making the level start at 1. And the constant <code><span class='Number'>1eÂ¯3</span></code> controls the speed of decay as before. Another option is to take the inverse square instead of just the inverse, or more generally any power. With an exponential this would be equivalent to changing the decay time because <code><span class='Paren'>(</span><span class='Function'>â‹†</span><span class='Value'>t</span><span class='Paren'>)</span><span class='Function'>â‹†</span><span class='Value'>p</span></code> is <code><span class='Function'>â‹†</span><span class='Value'>p</span><span class='Function'>Ã—</span><span class='Value'>t</span></code>. But here, higher powers smooth things out and lower ones make the curve sharper.</p>
<svg viewBox='-30 -30 336 118'>
  <g text-anchor='middle' fill='none'>
    <text fill='currentColor' x='128' y='-10'>1/tÂ² decay</text>
    <path stroke='currentColor' stroke-width='2' d='M0 0L6.4 5.95L12.8 11.107L19.2 15.607L25.6 19.556L32 23.04L38.4 26.13L44.8 28.883L51.2 31.347L57.6 33.56L64 35.556L70.4 37.361L76.8 39L83.2 40.492L89.6 41.855L96 43.102L102.4 44.247L108.8 45.3L115.2 46.271L121.6 47.169L128 48L134.4 48.771L140.8 49.488L147.2 50.155L153.6 50.777L160 51.358L166.4 51.902L172.8 52.411L179.2 52.889L185.6 53.338L192 53.76L198.4 54.158L204.8 54.533L211.2 54.886L217.6 55.221L224 55.537L230.4 55.837L236.8 56.121L243.2 56.39L249.6 56.646L256 56.889'/>
    <path stroke='currentColor' stroke-width='1' stroke-dasharray='5 7' d='M0 64L256 64'/>
  </g>
</svg>

<a class="replLink" title="Open in the REPL" target="_blank" href="https://mlochbaum.github.io/BQN/try.html#code=cyDihpAgNDQxMDAgICMgU2FtcGxlcyBpbiBvbmUgc2Vjb25kCnRvbmUg4oaQIOKAom1hdGguU2luICgyw5fPgCkgw5cgNDQwIMOXIOKGleKKuMO3IHMK4oCiUGxheSB7w7fDl8ucMSsyZcKvNMOX4oaV4omg8J2VqX3iirjDlyAoNMOXcykg4qWKIHRvbmU=">â†—ï¸</a><pre>    <span class='Function'>Play</span> <span class='Brace'>{</span><span class='Function'>Ã·Ã—</span><span class='Modifier'>Ëœ</span><span class='Number'>1</span><span class='Function'>+</span><span class='Number'>2eÂ¯4</span><span class='Function'>Ã—â†•â‰ </span><span class='Value'>ğ•©</span><span class='Brace'>}</span><span class='Modifier2'>âŠ¸</span><span class='Function'>Ã—</span> <span class='Paren'>(</span><span class='Number'>4</span><span class='Function'>Ã—</span><span class='Value'>s</span><span class='Paren'>)</span> <span class='Function'>â¥Š</span> <span class='Value'>tone</span>
<audio src="audio_envelope/a8.mp3" controls></audio>
</pre>
<p>You also have to decrease the constant for larger powers to keep the overall sound similar. As the exponent increases, this formula gets closer to an exponential: one definition for <code><span class='Function'>â‹†</span><span class='Value'>t</span></code> is the limit as <code><span class='Value'>p</span></code> goes to <code><span class='Number'>âˆ</span></code> of <code><span class='Paren'>(</span><span class='Number'>1</span><span class='Function'>+</span><span class='Value'>t</span><span class='Function'>Ã·</span><span class='Value'>p</span><span class='Paren'>)</span><span class='Function'>â‹†</span><span class='Value'>p</span></code>, so by inverting and scaling <code><span class='Value'>t</span></code> we find that <code><span class='Function'>â‹†-</span><span class='Value'>k</span><span class='Function'>Ã—</span><span class='Value'>t</span></code> or <code><span class='Function'>Ã·â‹†</span><span class='Value'>k</span><span class='Function'>Ã—</span><span class='Value'>t</span></code> is the limit of <code><span class='Function'>Ã·</span><span class='Paren'>(</span><span class='Number'>1</span><span class='Function'>+</span><span class='Paren'>(</span><span class='Value'>k</span><span class='Function'>Ã·</span><span class='Value'>p</span><span class='Paren'>)</span><span class='Function'>Ã—</span><span class='Value'>t</span><span class='Paren'>)</span><span class='Function'>â‹†</span><span class='Value'>p</span></code>. This also suggests that when multiplying the exponent by a factor <code><span class='Value'>f</span></code> the decay constant should be divided by roughly <code><span class='Value'>f</span></code>.</p>
<h2 id="onset"><a class="header" href="#onset">Onset</a></h2>
<p>In the previous section the notes all started instantly, which is generally not too great. With a sine wave, you can sort of get away with it because the wave itself starts at 0, but if the wave isn't perfectly aligned with the envelope you'll often get a click at this sort of abrupt change.</p>
<p>To have a better idea of how these notes sound I'll repeat each one a few times with <code><span class='Function'>â¥Š</span><span class='Number'>3</span><span class='Function'>/â‰</span><span class='Value'>note</span></code>. The idea here is that it adds a length-1 axis to the front with <code><span class='Function'>â‰</span></code>, repeats it three times, then deshapes to combine those repetitions. Here's our square-reciprocal envelope from before.</p>
<a class="replLink" title="Open in the REPL" target="_blank" href="https://mlochbaum.github.io/BQN/try.html#code=cyDihpAgNDQxMDAgICMgU2FtcGxlcyBpbiBvbmUgc2Vjb25kCnRvbmUg4oaQIOKAom1hdGguU2luICgyw5fPgCkgw5cgNDQwIMOXIOKGleKKuMO3IHMK4oCiUGxheSDipYozL+KJjSB7w7fDl8ucMSsyZcKvNMOX4oaV4omg8J2VqX3iirjDlyAoc8O3Mikg4oaRIHRvbmU=">â†—ï¸</a><pre>    <span class='Function'>Play</span> <span class='Function'>â¥Š</span><span class='Number'>3</span><span class='Function'>/â‰</span> <span class='Brace'>{</span><span class='Function'>Ã·Ã—</span><span class='Modifier'>Ëœ</span><span class='Number'>1</span><span class='Function'>+</span><span class='Number'>2eÂ¯4</span><span class='Function'>Ã—â†•â‰ </span><span class='Value'>ğ•©</span><span class='Brace'>}</span><span class='Modifier2'>âŠ¸</span><span class='Function'>Ã—</span> <span class='Paren'>(</span><span class='Value'>s</span><span class='Function'>Ã·</span><span class='Number'>2</span><span class='Paren'>)</span> <span class='Function'>â†‘</span> <span class='Value'>tone</span>
<audio src="audio_envelope/a9.mp3" controls></audio>
</pre>
<p>What about a softer onset, that won't poke through a mix as much? One way is to take the minimum of one envelope that increases quickly and another that decays. Since the onset is generally very short, its shape isn't all that important; a linear increase works fine.</p>
<svg viewBox='-30 -30 336 118'>
  <g text-anchor='middle' fill='none'>
    <text fill='currentColor' x='128' y='-10'>1/tÂ² with linear onset</text>
    <path stroke='currentColor' stroke-width='2' d='M0 64L6.4 48L12.8 32L19.2 16L25.6 19.556L32 23.04L38.4 26.13L44.8 28.883L51.2 31.347L57.6 33.56L64 35.556L70.4 37.361L76.8 39L83.2 40.492L89.6 41.855L96 43.102L102.4 44.247L108.8 45.3L115.2 46.271L121.6 47.169L128 48L134.4 48.771L140.8 49.488L147.2 50.155L153.6 50.777L160 51.358L166.4 51.902L172.8 52.411L179.2 52.889L185.6 53.338L192 53.76L198.4 54.158L204.8 54.533L211.2 54.886L217.6 55.221L224 55.537L230.4 55.837L236.8 56.121L243.2 56.39L249.6 56.646L256 56.889'/>
    <path stroke='currentColor' stroke-width='1' stroke-dasharray='5 7' d='M0 64L256 64'/>
  </g>
</svg>

<a class="replLink" title="Open in the REPL" target="_blank" href="https://mlochbaum.github.io/BQN/try.html#code=cyDihpAgNDQxMDAgICMgU2FtcGxlcyBpbiBvbmUgc2Vjb25kCnRvbmUg4oaQIOKAom1hdGguU2luICgyw5fPgCkgw5cgNDQwIMOXIOKGleKKuMO3IHMK4oCiUGxheSDipYozL+KJjSB7aeKGkOKGleKJoPCdlakg4ouEICgyZcKvM8OXaSkg4oyKIMO3w5fLnDErMmXCrzTDl2l94oq4w5cgKHPDtzIpIOKGkSB0b25lCgojIFZlcnkgc29mdCBhdHRhY2sK4oCiUGxheSDipYozL+KJjSB7aeKGkOKGleKJoPCdlakg4ouEICgyZcKvNMOXaSkg4oyKIMO3w5fLnDErMmXCrzTDl2l94oq4w5cgKHPDtzIpIOKGkSB0b25l">â†—ï¸</a><pre>    <span class='Function'>Play</span> <span class='Function'>â¥Š</span><span class='Number'>3</span><span class='Function'>/â‰</span> <span class='Brace'>{</span><span class='Value'>i</span><span class='Gets'>â†</span><span class='Function'>â†•â‰ </span><span class='Value'>ğ•©</span> <span class='Separator'>â‹„</span> <span class='Paren'>(</span><span class='Number'>2eÂ¯3</span><span class='Function'>Ã—</span><span class='Value'>i</span><span class='Paren'>)</span> <span class='Function'>âŒŠ</span> <span class='Function'>Ã·Ã—</span><span class='Modifier'>Ëœ</span><span class='Number'>1</span><span class='Function'>+</span><span class='Number'>2eÂ¯4</span><span class='Function'>Ã—</span><span class='Value'>i</span><span class='Brace'>}</span><span class='Modifier2'>âŠ¸</span><span class='Function'>Ã—</span> <span class='Paren'>(</span><span class='Value'>s</span><span class='Function'>Ã·</span><span class='Number'>2</span><span class='Paren'>)</span> <span class='Function'>â†‘</span> <span class='Value'>tone</span>
<audio src="audio_envelope/a10.mp3" controls></audio>

    <span class='Comment'># Very soft attack
</span>    <span class='Function'>Play</span> <span class='Function'>â¥Š</span><span class='Number'>3</span><span class='Function'>/â‰</span> <span class='Brace'>{</span><span class='Value'>i</span><span class='Gets'>â†</span><span class='Function'>â†•â‰ </span><span class='Value'>ğ•©</span> <span class='Separator'>â‹„</span> <span class='Paren'>(</span><span class='Number'>2eÂ¯4</span><span class='Function'>Ã—</span><span class='Value'>i</span><span class='Paren'>)</span> <span class='Function'>âŒŠ</span> <span class='Function'>Ã·Ã—</span><span class='Modifier'>Ëœ</span><span class='Number'>1</span><span class='Function'>+</span><span class='Number'>2eÂ¯4</span><span class='Function'>Ã—</span><span class='Value'>i</span><span class='Brace'>}</span><span class='Modifier2'>âŠ¸</span><span class='Function'>Ã—</span> <span class='Paren'>(</span><span class='Value'>s</span><span class='Function'>Ã·</span><span class='Number'>2</span><span class='Paren'>)</span> <span class='Function'>â†‘</span> <span class='Value'>tone</span>
<audio src="audio_envelope/a11.mp3" controls></audio>
</pre>
<p>This does make the loudest point ever so slightly less than 1. Another possibility is to <a href="https://mlochbaum.github.io/BQN/doc/shift.html">shift</a> an onset curve in with <code><span class='Function'>Â»</span></code>, delaying the start of the decay without making the overall envelope any longer.</p>
<a class="replLink" title="Open in the REPL" target="_blank" href="https://mlochbaum.github.io/BQN/try.html#code=cyDihpAgNDQxMDAgICMgU2FtcGxlcyBpbiBvbmUgc2Vjb25kCnRvbmUg4oaQIOKAom1hdGguU2luICgyw5fPgCkgw5cgNDQwIMOXIOKGleKKuMO3IHMK4oCiUGxheSDipYozL+KJjSB7KOKGleKKuMO3NTAwKSDCuyDDt8OXy5wxKzJlwq80w5fihpXiiaDwnZWpfeKKuMOXIChzw7cyKSDihpEgdG9uZQ==">â†—ï¸</a><pre>    <span class='Function'>Play</span> <span class='Function'>â¥Š</span><span class='Number'>3</span><span class='Function'>/â‰</span> <span class='Brace'>{</span><span class='Paren'>(</span><span class='Function'>â†•</span><span class='Modifier2'>âŠ¸</span><span class='Function'>Ã·</span><span class='Number'>500</span><span class='Paren'>)</span> <span class='Function'>Â»</span> <span class='Function'>Ã·Ã—</span><span class='Modifier'>Ëœ</span><span class='Number'>1</span><span class='Function'>+</span><span class='Number'>2eÂ¯4</span><span class='Function'>Ã—â†•â‰ </span><span class='Value'>ğ•©</span><span class='Brace'>}</span><span class='Modifier2'>âŠ¸</span><span class='Function'>Ã—</span> <span class='Paren'>(</span><span class='Value'>s</span><span class='Function'>Ã·</span><span class='Number'>2</span><span class='Paren'>)</span> <span class='Function'>â†‘</span> <span class='Value'>tone</span>
<audio src="audio_envelope/a12.mp3" controls></audio>
</pre>
<p>In real instruments there can actually be a lot of noise during the onset. Making a realistic onset for a guitar pluck or saxophoneâ€”uh, it's pretty much just spittingâ€”is very hard and a lot of digital instruments use samples instead. But here's an example of a sort of clicky sound added to the previous tone. Even this is enough to make it more physical and present.</p>
<a class="replLink" title="Open in the REPL" target="_blank" href="https://mlochbaum.github.io/BQN/try.html#code=cyDihpAgNDQxMDAgICMgU2FtcGxlcyBpbiBvbmUgc2Vjb25kCnRvbmUg4oaQIOKAom1hdGguU2luICgyw5fPgCkgw5cgNDQwIMOXIOKGleKKuMO3IHMKcGxhaW4g4oaQIHso4oaV4oq4w7c1MDApIMK7IMO3w5fLnDErMmXCrzTDl+KGleKJoPCdlal94oq4w5cgKHPDtzIpIOKGkSB0b25lCuKAolBsYXkg4qWKMy/iiY0gcGxhaW4ge/CdlagrKOKJoPCdlagp4oaR8J2VqX0gKDEwMOKlijAp4oi+MC40IMOXIC3in5zCrCDihpXiirjDtzEw">â†—ï¸</a><pre>    <span class='Value'>plain</span> <span class='Gets'>â†</span> <span class='Brace'>{</span><span class='Paren'>(</span><span class='Function'>â†•</span><span class='Modifier2'>âŠ¸</span><span class='Function'>Ã·</span><span class='Number'>500</span><span class='Paren'>)</span> <span class='Function'>Â»</span> <span class='Function'>Ã·Ã—</span><span class='Modifier'>Ëœ</span><span class='Number'>1</span><span class='Function'>+</span><span class='Number'>2eÂ¯4</span><span class='Function'>Ã—â†•â‰ </span><span class='Value'>ğ•©</span><span class='Brace'>}</span><span class='Modifier2'>âŠ¸</span><span class='Function'>Ã—</span> <span class='Paren'>(</span><span class='Value'>s</span><span class='Function'>Ã·</span><span class='Number'>2</span><span class='Paren'>)</span> <span class='Function'>â†‘</span> <span class='Value'>tone</span>
    <span class='Function'>Play</span> <span class='Function'>â¥Š</span><span class='Number'>3</span><span class='Function'>/â‰</span> <span class='Value'>plain</span> <span class='Brace'>{</span><span class='Value'>ğ•¨</span><span class='Function'>+</span><span class='Paren'>(</span><span class='Function'>â‰ </span><span class='Value'>ğ•¨</span><span class='Paren'>)</span><span class='Function'>â†‘</span><span class='Value'>ğ•©</span><span class='Brace'>}</span> <span class='Paren'>(</span><span class='Number'>100</span><span class='Function'>â¥Š</span><span class='Number'>0</span><span class='Paren'>)</span><span class='Function'>âˆ¾</span><span class='Number'>0.4</span> <span class='Function'>Ã—</span> <span class='Function'>-</span><span class='Modifier2'>âŸœ</span><span class='Function'>Â¬</span> <span class='Function'>â†•</span><span class='Modifier2'>âŠ¸</span><span class='Function'>Ã·</span><span class='Number'>10</span>
<audio src="audio_envelope/a13.mp3" controls></audio>
</pre>
