<head>
  <link href="../favicon.ico" rel="shortcut icon" type="image/x-icon"/>
  <link href="../style.css" rel="stylesheet"/>
  <title>BQN Musician: Envelopes</title>
</head>
<div class="nav">(<a href="https://github.com/mlochbaum/BQN-musician">github</a>) / <a href="../index.html">BQN Musician</a> / <a href="index.html">synth</a></div>
<h1 id="envelopes"><a class="header" href="#envelopes">Envelopes</a></h1>
<p>The envelope of a sound is how its volume changes as it's played, a sort of overall contour. A typical way to make a synthesized note is to multiply a continuous tone (whether an <a href="oscillator.html">oscillator</a> or something more complicated) by an envelope signal. To avoid changing that tone, the envelope shouldn't have any audible contentâ€”the volume should change gradually enough that it doesn't really contain frequencies above 20Hz. But the right envelope affects how the sound is perceived to a surprising degree, and can help a track sound more natural and compelling. This matters more in a dense mix: if one line just isn't fitting in, adjusting the envelope is something to try.</p>
<a class="replLink" title="Open in the REPL" target="_blank" href="https://mlochbaum.github.io/BQN/try.html#code=cyDihpAgNDQxMDAgICMgU2FtcGxlcyBpbiBvbmUgc2Vjb25kCnRvbmUg4oaQIOKAom1hdGguU2luICgyw5fPgCkgw5cgNDQwIMOXIOKGleKKuMO3IHMKIyBUaGUgcHVyZSB0b25lClBsYXkgdG9uZQojIFdpdGggc29tZSBzYW1wbGUgZW52ZWxvcGVzIGFwcGxpZWQKUGxheSDiiL7LnCB7MC45OTnii4bihpXiiaDwnZWpfeKKuMOXIHRvbmUKUGxheSDiiL7LnCB7MC45OTk54ouG4oaV4omg8J2VqX3iirjDlyB0b25lClBsYXkg4oi+y5wge2nihpDihpXiiaDwnZWp4ouEKGnDtzMwMCnijIoo4oy9MOKMiDQty5xpw7cyZTMp4oyKw7cxKzJlwq80w5dpfeKKuMOXIHRvbmU=">â†—ï¸</a><pre>    <span class='Value'>s</span> <span class='Gets'>â†</span> <span class='Number'>44100</span>  <span class='Comment'># Samples in one second
</span>    <span class='Value'>tone</span> <span class='Gets'>â†</span> <span class='Value'>â€¢math.</span><span class='Function'>Sin</span> <span class='Paren'>(</span><span class='Number'>2</span><span class='Function'>Ã—</span><span class='Number'>Ï€</span><span class='Paren'>)</span> <span class='Function'>Ã—</span> <span class='Number'>440</span> <span class='Function'>Ã—</span> <span class='Function'>â†•</span><span class='Modifier2'>âŠ¸</span><span class='Function'>Ã·</span> <span class='Value'>s</span>
    <span class='Comment'># The pure tone
</span>    <span class='Function'>Play</span> <span class='Value'>tone</span>
<audio src="audio_envelope/a0.mp3" controls></audio>
    <span class='Comment'># With some sample envelopes applied
</span>    <span class='Function'>Play</span> <span class='Function'>âˆ¾</span><span class='Modifier'>Ëœ</span> <span class='Brace'>{</span><span class='Number'>0.999</span><span class='Function'>â‹†â†•â‰ </span><span class='Value'>ğ•©</span><span class='Brace'>}</span><span class='Modifier2'>âŠ¸</span><span class='Function'>Ã—</span> <span class='Value'>tone</span>
<audio src="audio_envelope/a1.mp3" controls></audio>
    <span class='Function'>Play</span> <span class='Function'>âˆ¾</span><span class='Modifier'>Ëœ</span> <span class='Brace'>{</span><span class='Number'>0.9999</span><span class='Function'>â‹†â†•â‰ </span><span class='Value'>ğ•©</span><span class='Brace'>}</span><span class='Modifier2'>âŠ¸</span><span class='Function'>Ã—</span> <span class='Value'>tone</span>
<audio src="audio_envelope/a2.mp3" controls></audio>
    <span class='Function'>Play</span> <span class='Function'>âˆ¾</span><span class='Modifier'>Ëœ</span> <span class='Brace'>{</span><span class='Value'>i</span><span class='Gets'>â†</span><span class='Function'>â†•â‰ </span><span class='Value'>ğ•©</span><span class='Separator'>â‹„</span><span class='Paren'>(</span><span class='Value'>i</span><span class='Function'>Ã·</span><span class='Number'>300</span><span class='Paren'>)</span><span class='Function'>âŒŠ</span><span class='Paren'>(</span><span class='Function'>âŒ½</span><span class='Number'>0</span><span class='Function'>âŒˆ</span><span class='Number'>4</span><span class='Function'>-</span><span class='Modifier'>Ëœ</span><span class='Value'>i</span><span class='Function'>Ã·</span><span class='Number'>2e3</span><span class='Paren'>)</span><span class='Function'>âŒŠÃ·</span><span class='Number'>1</span><span class='Function'>+</span><span class='Number'>2eÂ¯4</span><span class='Function'>Ã—</span><span class='Value'>i</span><span class='Brace'>}</span><span class='Modifier2'>âŠ¸</span><span class='Function'>Ã—</span> <span class='Value'>tone</span>
<audio src="audio_envelope/a3.mp3" controls></audio>
</pre>
<p>(One comment on composition: silence is a big deal! The riffs that really land often have rests where you'd expect a note, or a carefully placed stacatto. Is that one change you're searching for to add, or to take away?)</p>
<h2 id="decay"><a class="header" href="#decay">Decay</a></h2>
<p>Like a sine wave is the most basic oscillator, I think of exponential decay as the most basic envelope. They're pretty closely related: a perfect oscillator gives you a sine wave, but one with friction gives you a sine with exponential decay.</p>
<svg viewBox='-30 -30 336 118'>
  <g text-anchor='middle' fill='none'>
    <text fill='currentColor' x='128' y='-10'>Exponential decay</text>
    <path stroke='currentColor' stroke-width='2' d='M0 0L6.4 4.618L12.8 8.903L19.2 12.879L25.6 16.567L32 19.99L38.4 23.166L44.8 26.112L51.2 28.846L57.6 31.383L64 33.736L70.4 35.92L76.8 37.946L83.2 39.826L89.6 41.571L96 43.189L102.4 44.691L108.8 46.084L115.2 47.377L121.6 48.576L128 49.689L134.4 50.722L140.8 51.68L147.2 52.569L153.6 53.394L160 54.159L166.4 54.869L172.8 55.528L179.2 56.139L185.6 56.707L192 57.233L198.4 57.721L204.8 58.174L211.2 58.595L217.6 58.985L224 59.347L230.4 59.682L236.8 59.994L243.2 60.283L249.6 60.551L256 60.8'/>
    <path stroke='currentColor' stroke-width='1' stroke-dasharray='5 7' d='M0 64L256 64'/>
  </g>
</svg>

<a class="replLink" title="Open in the REPL" target="_blank" href="https://mlochbaum.github.io/BQN/try.html#code=cyDihpAgNDQxMDAgICMgU2FtcGxlcyBpbiBvbmUgc2Vjb25kCnRvbmUg4oaQIOKAom1hdGguU2luICgyw5fPgCkgw5cgNDQwIMOXIOKGleKKuMO3IHMKUGxheSAoMC45OTk5NCDii4Yg4oaVNMOXcykgw5cgKDTDl3MpIOKliiB0b25l">â†—ï¸</a><pre>    <span class='Function'>Play</span> <span class='Paren'>(</span><span class='Number'>0.99994</span> <span class='Function'>â‹†</span> <span class='Function'>â†•</span><span class='Number'>4</span><span class='Function'>Ã—</span><span class='Value'>s</span><span class='Paren'>)</span> <span class='Function'>Ã—</span> <span class='Paren'>(</span><span class='Number'>4</span><span class='Function'>Ã—</span><span class='Value'>s</span><span class='Paren'>)</span> <span class='Function'>â¥Š</span> <span class='Value'>tone</span>
<audio src="audio_envelope/a4.mp3" controls></audio>
</pre>
<p>The start is too sharp to match anything real (we'll get to that), but eventually it starts to sound like a tuning fork, or maybe some sort of chime. These are very nearly perfect oscillators with friction!</p>
<p>The envelope <code><span class='Number'>0.99994</span> <span class='Function'>â‹†</span> <span class='Function'>â†•</span><span class='Number'>4</span><span class='Function'>Ã—</span><span class='Value'>s</span></code> simply starts at one and decreases by a factor of <code><span class='Number'>0.99994</span></code> each time. But that constant isn't very nice to work with, because counting nines is no fun. What I do instead of changing the base of the exponent is to use a fixed base and multiply the exponential part. This is equivalent to changing the base because <code><span class='Value'>b</span><span class='Function'>â‹†</span><span class='Value'>c</span><span class='Function'>Ã—</span><span class='Value'>i</span></code> is <code><span class='Paren'>(</span><span class='Value'>b</span><span class='Function'>â‹†</span><span class='Value'>c</span><span class='Paren'>)</span><span class='Function'>â‹†</span><span class='Value'>i</span></code>. Another thing I'll do while I'm cleaning up the code is avoid repeating the length. I'll make a function to compute the envelope from the signal being enveloped, and then apply it with <code><span class='Function'>Env</span><span class='Modifier2'>âŠ¸</span><span class='Function'>Ã—</span></code>. Since the <a href="https://mlochbaum.github.io/BQN/doc/hook.html">hook</a> <code><span class='Function'>Env</span><span class='Modifier2'>âŠ¸</span><span class='Function'>Ã—</span> <span class='Value'>s</span></code> means <code><span class='Paren'>(</span><span class='Function'>Env</span> <span class='Value'>s</span><span class='Paren'>)</span> <span class='Function'>Ã—</span> <span class='Value'>s</span></code>, this multiplies the signal by its envelope.</p>
<a class="replLink" title="Open in the REPL" target="_blank" href="https://mlochbaum.github.io/BQN/try.html#code=cyDihpAgNDQxMDAgICMgU2FtcGxlcyBpbiBvbmUgc2Vjb25kCnRvbmUg4oaQIOKAom1hdGguU2luICgyw5fPgCkgw5cgNDQwIMOXIOKGleKKuMO3IHMK4ouG4oG8IDAuOTk5OTQK4p+oMC45OTk5NOKLhjAuNCwg4ouGKOKLhuKBvDAuOTk5OTQpw5cwLjTin6kgICMgU2FtZSB0aGluZyEKCiMgICAgKOKLhiDCrzZlwq81IMOX4oaVNMOXcykgw5cgKDTDl3MpIOKliiB0b25lClBsYXkge+KLhiDCrzZlwq81IMOXIOKGleKJoPCdlal94oq4w5cgKDTDl3MpIOKliiB0b25l">â†—ï¸</a><pre>    <span class='Function'>â‹†</span><span class='Modifier'>â¼</span> <span class='Number'>0.99994</span>
Â¯6.000180007195222eÂ¯5
    <span class='Bracket'>âŸ¨</span><span class='Number'>0.99994</span><span class='Function'>â‹†</span><span class='Number'>0.4</span><span class='Separator'>,</span> <span class='Function'>â‹†</span><span class='Paren'>(</span><span class='Function'>â‹†</span><span class='Modifier'>â¼</span><span class='Number'>0.99994</span><span class='Paren'>)</span><span class='Function'>Ã—</span><span class='Number'>0.4</span><span class='Bracket'>âŸ©</span>  <span class='Comment'># Same thing!
</span>âŸ¨ 0.9999759995679862 0.9999759995679862 âŸ©

    <span class='Comment'>#    (â‹† Â¯6eÂ¯5 Ã—â†•4Ã—s) Ã— (4Ã—s) â¥Š tone
</span>    <span class='Function'>Play</span> <span class='Brace'>{</span><span class='Function'>â‹†</span> <span class='Number'>Â¯6eÂ¯5</span> <span class='Function'>Ã—</span> <span class='Function'>â†•â‰ </span><span class='Value'>ğ•©</span><span class='Brace'>}</span><span class='Modifier2'>âŠ¸</span><span class='Function'>Ã—</span> <span class='Paren'>(</span><span class='Number'>4</span><span class='Function'>Ã—</span><span class='Value'>s</span><span class='Paren'>)</span> <span class='Function'>â¥Š</span> <span class='Value'>tone</span>
<audio src="audio_envelope/a5.mp3" controls></audio>
</pre>
<p>Exponential decay gives a very clean, polite sound. If I'm trying to put more emphasis on a sound I go for something that lingers longer. One way is actually a sum of two or more exponentials with different bases, because the shorter one gives an initial impact and then the longer one keeps going. More aggressive is to take a function that falls off with <code><span class='Function'>Ã·</span><span class='Value'>i</span></code> (or <code><span class='Value'>i</span><span class='Function'>â‹†</span><span class='Number'>Â¯1</span></code>) instead of <code><span class='Function'>â‹†-</span><span class='Value'>i</span></code>. Hear how it starts with less power but just keeps going.</p>
<svg viewBox='-30 -30 336 118'>
  <g text-anchor='middle' fill='none'>
    <text fill='currentColor' x='128' y='-10'>1/t decay</text>
    <path stroke='currentColor' stroke-width='2' d='M0 0L6.4 8.348L12.8 14.769L19.2 19.862L25.6 24L32 27.429L38.4 30.316L44.8 32.78L51.2 34.909L57.6 36.766L64 38.4L70.4 39.849L76.8 41.143L83.2 42.305L89.6 43.355L96 44.308L102.4 45.176L108.8 45.972L115.2 46.703L121.6 47.377L128 48L134.4 48.578L140.8 49.116L147.2 49.618L153.6 50.087L160 50.526L166.4 50.939L172.8 51.327L179.2 51.692L185.6 52.037L192 52.364L198.4 52.673L204.8 52.966L211.2 53.244L217.6 53.508L224 53.76L230.4 54L236.8 54.229L243.2 54.448L249.6 54.657L256 54.857'/>
    <path stroke='currentColor' stroke-width='1' stroke-dasharray='5 7' d='M0 64L256 64'/>
  </g>
</svg>

<a class="replLink" title="Open in the REPL" target="_blank" href="https://mlochbaum.github.io/BQN/try.html#code=cyDihpAgNDQxMDAgICMgU2FtcGxlcyBpbiBvbmUgc2Vjb25kCnRvbmUg4oaQIOKAom1hdGguU2luICgyw5fPgCkgw5cgNDQwIMOXIOKGleKKuMO3IHMKUGxheSB7w7cxKzFlwq8zw5fihpXiiaDwnZWpfeKKuMOXICg0w5dzKSDipYogdG9uZQ==">â†—ï¸</a><pre>    <span class='Function'>Play</span> <span class='Brace'>{</span><span class='Function'>Ã·</span><span class='Number'>1</span><span class='Function'>+</span><span class='Number'>1eÂ¯3</span><span class='Function'>Ã—â†•â‰ </span><span class='Value'>ğ•©</span><span class='Brace'>}</span><span class='Modifier2'>âŠ¸</span><span class='Function'>Ã—</span> <span class='Paren'>(</span><span class='Number'>4</span><span class='Function'>Ã—</span><span class='Value'>s</span><span class='Paren'>)</span> <span class='Function'>â¥Š</span> <span class='Value'>tone</span>
<audio src="audio_envelope/a6.mp3" controls></audio>
</pre>
